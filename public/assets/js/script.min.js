document.addEventListener("DOMContentLoaded",function(){initAnimations();initFormValidation();initTableInteractions();initSearchFunctionality();initThemeToggle();initNotifications()});function initAnimations(){const e=document.querySelectorAll(".card, .section-card, .data-card"),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)")})},{threshold:.1});e.forEach(e=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity 0.6s ease, transform 0.6s ease",t.observe(e)});const n=document.querySelectorAll(".btn, .action-btn, .nav-btn");n.forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateY(-2px) scale(1.02)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateY(0) scale(1)"})})}function initFormValidation(){const e=document.querySelectorAll("form");e.forEach(e=>{const t=e.querySelectorAll("input, textarea, select");t.forEach(e=>{"hidden"!==e.type&&"submit"!==e.type&&(e.addEventListener("focus",function(){this.parentElement.classList.add("focused")}),e.addEventListener("blur",function(){this.value||this.parentElement.classList.remove("focused")})),e.addEventListener("input",function(){validateField(this)})}),e.addEventListener("submit",function(e){validateForm(this)||(e.preventDefault(),showNotification("يرجى تصحيح الأخطاء في النموذج / Veuillez corriger les erreurs dans le formulaire","error"))})})}function validateField(e){const t=e.value.trim(),n=e.name;let r=!0,o="";e.classList.remove("error");const i=e.parentElement.querySelector(".field-error");switch(i&&i.remove(),n){case"username":t.length<3&&(r=!1,o="اسم المستخدم يجب أن يكون 3 أحرف على الأقل / Le nom d'utilisateur doit contenir au moins 3 caractères");break;case"password":t.length<6&&(r=!1,o="كلمة المرور يجب أن تكون 6 أحرف على الأقل / Le mot de passe doit contenir au moins 6 caractères");break;case"title":t.length<2&&(r=!1,o="العنوان يجب أن يكون حرفين على الأقل / Le titre doit contenir au moins 2 caractères");break;case"author":t.length<2&&(r=!1,o="اسم المؤلف يجب أن يكون حرفين على الأقل / Le nom de l'auteur doit contenir au moins 2 caractères");break;case"year_pub":const s=parseInt(t);(isNaN(s)||s<1800||s>(new Date).getFullYear())&&(r=!1,o="سنة النشر غير صحيحة / Année de publication invalide")}if(!r){e.classList.add("error");const t=document.createElement("div");t.className="field-error",t.textContent=o,e.parentElement.appendChild(t)}return r}function validateForm(e){const t=e.querySelectorAll("input[required], textarea[required], select[required]");let n=!0;return t.forEach(e=>{validateField(e)||(n=!1)}),n}function initTableInteractions(){const e=document.querySelectorAll("table");e.forEach(e=>{const t=e.querySelectorAll("tbody tr");t.forEach(e=>{e.addEventListener("mouseenter",function(){this.style.backgroundColor="var(--bg-tertiary)"}),e.addEventListener("mouseleave",function(){this.style.backgroundColor=""}),e.addEventListener("click",function(e){e.target.closest("a, button")||this.classList.toggle("selected")})})})}function initSearchFunctionality(){const e=document.querySelectorAll('input[type="search"], .search-input');e.forEach(e=>{e.addEventListener("input",debounce(function(){const e=this.value.toLowerCase(),t=this.closest(".page-container").querySelector("table");if(t){const n=t.querySelectorAll("tbody tr");n.forEach(t=>{const n=t.textContent.toLowerCase();n.includes(e)?t.style.display="":t.style.display="none"})}},300))})}function initThemeToggle(){const e=document.querySelector(".theme-toggle");e&&e.addEventListener("click",function(){document.body.classList.toggle("dark-theme");const e=document.body.classList.contains("dark-theme");localStorage.setItem("theme",e?"dark":"light")});"dark"===localStorage.getItem("theme")&&document.body.classList.add("dark-theme")}function initNotifications(){if(!document.querySelector(".notification-container")){const e=document.createElement("div");e.className="notification-container",document.body.appendChild(e)}}function showNotification(e,t="info",n=5e3){const r=document.querySelector(".notification-container"),o=document.createElement("div");o.className=`notification notification-${t}`;const i=document.createElement("i");i.className=getNotificationIcon(t);const s=document.createElement("span");s.textContent=e;const a=document.createElement("button");a.innerHTML="&times;",a.className="notification-close",a.onclick=()=>removeNotification(o),o.appendChild(i),o.appendChild(s),o.appendChild(a),r.appendChild(o),setTimeout(()=>{removeNotification(o)},n),setTimeout(()=>{o.classList.add("show")},100)}function removeNotification(e){e.classList.remove("show"),setTimeout(()=>{e.parentElement&&e.parentElement.removeChild(e)},300)}function getNotificationIcon(e){const t={success:"fas fa-check-circle",error:"fas fa-exclamation-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle"};return t[e]||t.info}function debounce(e,t){let n;return function(...r){const o=()=>{clearTimeout(n),e(...r)};clearTimeout(n),n=setTimeout(o,t)}}function formatDate(e){return new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long",day:"numeric"}).format(new Date(e))}function formatNumber(e){return new Intl.NumberFormat("ar-SA").format(e)}window.LibrarySystem={showNotification,formatDate,formatNumber,validateField,validateForm};const style=document.createElement("style");style.textContent=`.field-error{color:var(--error-color);font-size:.75rem;margin-top:.25rem;display:flex;align-items:center;gap:.25rem}.field-error::before{content:'⚠';font-size:.875rem}.form-input.error{border-color:var(--error-color);box-shadow:0 0 0 3px rgb(239 68 68/.1)}.notification-container{position:fixed;top:2rem;right:2rem;z-index:1000;display:flex;flex-direction:column;gap:.5rem;max-width:400px}.notification{background:var(--bg-primary);border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:1rem 1.5rem;box-shadow:var(--shadow-lg);display:flex;align-items:center;gap:.75rem;transform:translateX(100%);opacity:0;transition:all .3s ease}.notification.show{transform:translateX(0);opacity:1}.notification-success{border-left:4px solid var(--success-color)}.notification-error{border-left:4px solid var(--error-color)}.notification-warning{border-left:4px solid var(--warning-color)}.notification-info{border-left:4px solid var(--primary-color)}.notification-close{background:none;border:none;font-size:1.25rem;cursor:pointer;color:var(--text-light);margin-left:auto;padding:0;width:1.5rem;height:1.5rem;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);transition:all .2s ease}.notification-close:hover{background:var(--bg-secondary);color:var(--text-primary)}tr.selected{background:rgb(37 99 235/.1)!important;border-left:4px solid var(--primary-color)}.dark-theme{--text-primary:#f9fafb;--text-secondary:#d1d5db;--text-light:#9ca3af;--bg-primary:#1f2937;--bg-secondary:#111827;--bg-tertiary:#374151;--border-color:#374151;--border-hover:#4b5563}@media (max-width:768px){.notification-container{top:1rem;right:1rem;left:1rem;max-width:none}}`,document.head.appendChild(style);